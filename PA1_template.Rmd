---
title: "Reproducible Research: Peer Assessment 1"
output: 
  html_document:
    keep_md: true
---


## Loading and preprocessing the data

```{r echo=TRUE}
library(data.table)
library(dplyr)
library(lubridate)
library(lattice)
library(ggplot2)

zipfile <- "activity.zip"
datafile <- "activity.csv"

setwd("~/RCode/Reproducable/RepData_PeerAssessment1/")

if(!file.exists(datafile))
{
     if(!file.exists(zipfile)) warning("Missing data files.")
     
     unzip(zipfile)
          
}

stepDataRaw <- read.csv(datafile, stringsAsFactors=FALSE)

## Create a variable for only the complete cases of the data.
stepsComp <- stepDataRaw[complete.cases(stepDataRaw),]

```

## What is mean total number of steps taken per day?

```{r echo=TRUE}
stepsComp <- stepDataRaw[complete.cases(stepDataRaw),]
stepsComp <- data.table(stepsComp)
stepsPerDay <- summarize(group_by(stepsComp, date), sum(steps))
setnames(stepsPerDay, names(stepsPerDay), c("Date", "Total.Steps"))
hist(stepsPerDay$Total.Steps,xlab ="Steps Per Day", ylab="Number of Days")

meanSteps1 <- as.integer(mean(stepsPerDay$Total.Steps))
medianSteps1 <- as.integer(median(stepsPerDay$Total.Steps))
```

### Mean and median of the total number of steps taken per day
Average Number of Steps Per Day: `r meanSteps1`  
Median Number of Steps Per Day: `r medianSteps1`

## What is the average daily activity pattern?
Make a time series plot (i.e. type = "l") of the 5-minute interval (x-axis) and the average number of steps taken, averaged across all days (y-axis)

```{r}
stepAveByInterval <- summarize(group_by(stepsComp, interval), mean(steps))
plot(stepAveByInterval$interval, stepAveByInterval$mean, type="l", xlab="Time Interval", ylab="Average Steps", main ="Average Steps Per Time Interval")

```

Which 5-minute interval, on average across all the days in the dataset, contains the maximum number of steps?
```{r}
maxVector <- stepAveByInterval[(stepAveByInterval$mean == max(stepAveByInterval$mean)),]
```

The interval with the highest average is: `r maxVector$interval`


## Imputing missing values
Note that there are a number of days/intervals where there are missing values (coded as NA). The presence of missing days may introduce bias into some calculations or summaries of the data.

Calculate and report the total number of missing values in the dataset (i.e. the total number of rows with NAs)

We can do this with the complete.cases or simply by checking is.na
```{r}
rawRows <- nrow(stepDataRaw)
completeRows <- nrow(stepsComp)

```

Raw data row count:  `r rawRows`  
Number of NA Rows: `r rawRows - completeRows`

In order to remove some of the bias caused by the NA rows stated above we will modify the data set and replace the NA values with the average steps for the specific time interval from the larger data.

```{r echo=TRUE}
naRowIndices <- which(is.na(stepDataRaw$steps))

for(i in naRowIndices)
{
   rawInterval <- stepDataRaw[i,3]
   stepDataRaw[i,1] <- stepAveByInterval[(stepAveByInterval$interval==rawInterval),2]
}


newStepsPerDay <- summarize(group_by(stepDataRaw, date), sum(steps))
setnames(newStepsPerDay, names(newStepsPerDay), c("Date", "Total.Steps"))
hist(newStepsPerDay$Total.Steps,xlab ="Steps Per Day", ylab="Number of Days")

meanSteps2 <- as.integer(mean(newStepsPerDay$Total.Steps))
medianSteps2 <- as.integer(median(newStepsPerDay$Total.Steps))
```

### Mean and median of the total number of steps taken per day
Average Number of Steps Per Day (accounting for bias): `r meanSteps2`  
Median Number of Steps Per Day (accounting for bias): `r medianSteps2`

*Average Number of Steps Per Day (ORIGINAL): `r meanSteps1`*   
*Median Number of Steps Per Day (ORIGINAL): `r medianSteps1`*


## Are there differences in activity patterns between weekdays and weekends?

Create a new factor variable in the dataset with two levels - "weekday" and "weekend" indicating whether a given date is a weekday or weekend day.
```{r}
factoredData <- mutate(stepDataRaw, newdate=as.factor(ifelse(wday(strptime(date,"%Y-%m-%d")) %in% 2:6, "WEEKDAY", "WEEKEND")))

# ggplot() + geom_line(data=factoredData, aes(x=interval, y=steps)) + facet_grid(. ~ newdate)

factoredSummarized <- summarize(group_by(factoredData, newdate, interval), mean(steps))
ggplot() + geom_line(data=factoredSummarized, aes(x=interval, y=factoredSummarized$mean)) + facet_grid(. ~ newdate)
```
